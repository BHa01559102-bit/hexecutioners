<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Detective - Hexecutioners</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .game-header {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .game-title h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .game-title p {
            color: #666;
            font-size: 14px;
        }
        
        .stats-section {
            display: flex;
            gap: 30px;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-box h3 {
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .stat-box .value {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }
        
        .game-area {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }
        
        .case-brief {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .case-brief h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .case-brief p {
            font-size: 14px;
        }
        
        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .chart-box {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .chart-box h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 150px;
            gap: 10px;
        }
        
        .bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .bar-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px 4px 0 0;
            min-width: 30px;
        }
        
        .bar-label {
            font-size: 12px;
            font-weight: 600;
            color: #333;
        }
        
        .table-chart {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .table-chart th {
            background: #667eea;
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: 600;
        }
        
        .table-chart td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .table-chart tr:hover {
            background: #f5f5f5;
        }
        
        .question-container {
            margin-bottom: 25px;
        }
        
        .question-type {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .question-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            background: white;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .option:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .option.correct {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            border-color: #38f9d7;
        }
        
        .option.incorrect {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
            color: white;
            border-color: #ff4757;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            font-size: 14px;
            flex: 1;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-content h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 28px;
        }
        
        .score-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
        }
        
        .case-count {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .button-group-modal {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <div class="game-title">
                <h1>üïµÔ∏è Chart Detective: Case Files</h1>
                <p>Solve data mysteries with inference and reasoning</p>
            </div>
            <div class="stats-section">
                <div class="stat-box">
                    <h3>Cases Solved</h3>
                    <div class="value" id="caseCount">0</div>
                </div>
                <div class="stat-box">
                    <h3>Score</h3>
                    <div class="value" id="scoreDisplay">0</div>
                </div>
            </div>
        </div>
        
        <div class="game-area">
            <div id="caseContent">
                <!-- Case will be loaded here -->
            </div>
            
            <div class="button-group">
                <button onclick="skipCase()">‚è≠ Skip Case</button>
                <button onclick="submitAnswer()" id="submitBtn" disabled>Submit Answer</button>
                <button onclick="endGame()">‚Üê Back to Games</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="endModal">
        <div class="modal-content">
            <h2>Detective Session Complete!</h2>
            <div class="case-count" id="finalStats">0/0 Cases Solved</div>
            <div class="score-display" id="finalScore">0</div>
            <div class="button-group-modal">
                <button class="btn-secondary" onclick="goToGames()">Back to Games</button>
                <button onclick="restartGame()">Play Again</button>
            </div>
        </div>
    </div>
    
    <script>
        let gameState = {
            score: 0,
            currentCase: 0,
            correctAnswers: 0,
            totalCases: 5,
            selectedAnswer: null,
            cases: []
        };
        
        const casesBank = [
            {
                title: 'Sales Performance Analysis',
                brief: 'Our Q1-Q4 sales data shows seasonal patterns. Q1 had 50 units, Q2 had 75 units, Q3 had 60 units, and Q4 had 90 units. Which quarter had the median sales?',
                charts: {
                    type: 'bar',
                    data: [
                        { label: 'Q1', value: 50 },
                        { label: 'Q2', value: 75 },
                        { label: 'Q3', value: 60 },
                        { label: 'Q4', value: 90 }
                    ]
                },
                question: 'What is the median quarterly sales?',
                answers: ['65 units', '70 units', '60 units', '75 units'],
                correct: 0
            },
            {
                title: 'Student Performance Tracking',
                brief: 'A teacher recorded test scores: Math 85, Science 92, English 78, History 88. Calculate the average score.',
                charts: {
                    type: 'table',
                    data: [
                        { subject: 'Math', score: 85 },
                        { subject: 'Science', score: 92 },
                        { subject: 'English', score: 78 },
                        { subject: 'History', score: 88 }
                    ]
                },
                question: 'What is the average score across all subjects?',
                answers: ['85.75', '88', '86.75', '87'],
                correct: 0
            },
            {
                title: 'Product Revenue Growth',
                brief: 'Product A revenue: Jan $1000, Feb $1500, Mar $2000, Apr $2500. Which period shows the highest growth percentage?',
                charts: {
                    type: 'bar',
                    data: [
                        { label: 'Jan', value: 1000 },
                        { label: 'Feb', value: 1500 },
                        { label: 'Mar', value: 2000 },
                        { label: 'Apr', value: 2500 }
                    ]
                },
                question: 'What is the growth rate from Jan to Apr?',
                answers: ['150%', '250%', '200%', '120%'],
                correct: 0
            },
            {
                title: 'Employee Attendance Report',
                brief: 'Monday: 95 employees, Tuesday: 93, Wednesday: 94, Thursday: 92, Friday: 91. Which statement best fits?',
                charts: {
                    type: 'table',
                    data: [
                        { day: 'Monday', count: 95 },
                        { day: 'Tuesday', count: 93 },
                        { day: 'Wednesday', count: 94 },
                        { day: 'Thursday', count: 92 },
                        { day: 'Friday', count: 91 }
                    ]
                },
                question: 'What trend is shown in the attendance data?',
                answers: ['Declining trend throughout week', 'Stable attendance', 'Increasing trend', 'No pattern'],
                correct: 0
            },
            {
                title: 'Budget Allocation Analysis',
                brief: 'Monthly expenses: Marketing $5000, Operations $8000, R&D $6000, Admin $3000. What percentage is R&D?',
                charts: {
                    type: 'table',
                    data: [
                        { department: 'Marketing', expense: 5000 },
                        { department: 'Operations', expense: 8000 },
                        { department: 'R&D', expense: 6000 },
                        { department: 'Admin', expense: 3000 }
                    ]
                },
                question: 'R&D is what percentage of total budget?',
                answers: ['25%', '30%', '35%', '20%'],
                correct: 0
            }
        ];
        
        function initGame() {
            gameState.cases = casesBank;
            loadCase();
        }
        
        function loadCase() {
            if (gameState.currentCase >= gameState.cases.length) {
                endGame();
                return;
            }
            
            gameState.selectedAnswer = null;
            const caseData = gameState.cases[gameState.currentCase];
            
            let chartHTML = '';
            if (caseData.charts.type === 'bar') {
                chartHTML = `
                    <div class="chart-box">
                        <h4>Quarterly Data</h4>
                        <div class="bar-chart">
                            ${caseData.charts.data.map(item => {
                                const maxValue = Math.max(...caseData.charts.data.map(d => d.value));
                                const height = (item.value / maxValue) * 120;
                                return `
                                    <div class="bar">
                                        <div class="bar-fill" style="height: ${height}px;"></div>
                                        <div class="bar-label">${item.label}: ${item.value}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            } else {
                chartHTML = `
                    <div class="chart-box">
                        <h4>Data Table</h4>
                        <table class="table-chart">
                            <thead>
                                <tr>
                                    ${Object.keys(caseData.charts.data[0]).map(key => `<th>${key}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${caseData.charts.data.map(row => `
                                    <tr>
                                        ${Object.values(row).map(val => `<td>${val}</td>`).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            const caseHTML = `
                <div class="case-brief">
                    <h3>üìÅ Case ${gameState.currentCase + 1}: ${caseData.title}</h3>
                    <p>${caseData.brief}</p>
                </div>
                
                <div class="chart-container">
                    ${chartHTML}
                </div>
                
                <div class="question-container">
                    <div class="question-type">DATA REASONING</div>
                    <div class="question-text">${caseData.question}</div>
                    <div class="options">
                        ${caseData.answers.map((answer, idx) => `
                            <div class="option" onclick="selectAnswer(${idx})">${answer}</div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('caseContent').innerHTML = caseHTML;
            document.getElementById('submitBtn').disabled = true;
        }
        
        function selectAnswer(index) {
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.option')[index].classList.add('selected');
            gameState.selectedAnswer = index;
            document.getElementById('submitBtn').disabled = false;
        }
        
        function submitAnswer() {
            if (gameState.selectedAnswer === null) return;
            
            const caseData = gameState.cases[gameState.currentCase];
            const options = document.querySelectorAll('.option');
            
            if (gameState.selectedAnswer === caseData.correct) {
                gameState.score += 200;
                gameState.correctAnswers++;
                options[gameState.selectedAnswer].classList.add('correct');
            } else {
                options[gameState.selectedAnswer].classList.add('incorrect');
                options[caseData.correct].classList.add('correct');
            }
            
            document.getElementById('submitBtn').disabled = true;
            
            setTimeout(() => {
                gameState.currentCase++;
                document.getElementById('caseCount').textContent = gameState.currentCase;
                document.getElementById('scoreDisplay').textContent = gameState.score;
                loadCase();
            }, 1500);
        }
        
        function skipCase() {
            gameState.currentCase++;
            document.getElementById('caseCount').textContent = gameState.currentCase;
            loadCase();
        }
        
        function endGame() {
            const modal = document.getElementById('endModal');
            document.getElementById('finalStats').textContent = `${gameState.correctAnswers}/${gameState.totalCases} Cases Solved`;
            document.getElementById('finalScore').textContent = gameState.score;
            modal.classList.add('show');
            
            saveScore(gameState.score);
        }
        
        function restartGame() {
            gameState = {
                score: 0,
                currentCase: 0,
                correctAnswers: 0,
                totalCases: 5,
                selectedAnswer: null,
                cases: casesBank
            };
            document.getElementById('endModal').classList.remove('show');
            initGame();
        }
        
        function goToGames() {
            window.location.href = '/games';
        }
        
        async function saveScore(score) {
            try {
                const response = await fetch('/api/save-score', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        game_name: 'Chart Detective',
                        score: score,
                        skills: ['Data Interpretation', 'Verbal Reasoning', 'Analytical Reasoning']
                    })
                });
                const data = await response.json();
                console.log('Score saved:', data);
            } catch (error) {
                console.error('Error saving score:', error);
            }
        }
        
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
